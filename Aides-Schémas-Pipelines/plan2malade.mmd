graph TD
    %% --- Styles ---
    classDef python fill:#ffe082,stroke:#ffb300,stroke-width:2px,color:black;
    classDef julia fill:#ce93d8,stroke:#8e24aa,stroke-width:2px,color:black;
    classDef data fill:#e1f5fe,stroke:#0277bd,stroke-width:2px,color:black;
    classDef dvc fill:#f5f5f5,stroke:#616161,stroke-width:2px,stroke-dasharray: 5 5,color:black;

    %% --- External Resources ---
    subgraph External_Resources ["Phase 1: External Inputs"]
        API[("Copernicus API<br>(CDS)")]
        Shapefiles[("data/shapefiles/<br>Regions & Depts")]:::data
        
        %% DVC Remote with Personal API
        GDrive[("Google Drive<br>(Personal API)<br>DVC Remote")]:::dvc
    end

    %% --- DVC Pipeline (The Core) ---
    subgraph DVC_Orchestrator ["Phases 2-3: DVC Pipeline"]
        direction TB
        
        %% Step 1: Download
        Py_DL["src/download.py<br>(Python + cdsapi)"]:::python
        Raw_Data[/"data/raw/<br>Monthly .nc"/]:::data
        
        %% Step 2: Masks (Julia)
        Jl_Mask["src/make_masks.jl<br>(Julia ArchGDAL & LibGEOS)"]:::julia
        Mask_Data[/"data/masks/<br>Boolean Mask .nc"/]:::data

        %% Step 3: Static Visualization (Julia)

    end

    %% --- Final Product (Bonito) ---
    subgraph App_Layer ["Phase 4: Web Application (Julia)"]
        Jl_App["src/app.jl<br>(Bonito)"]:::julia
        Jl_Visu["src/visu.jl<br>(Julia Plots, GLM, Glob)"]:::julia
    end
    %% --- Connections ---
    
    %% Data Flow
    API ==> Py_DL
    Py_DL ==> Raw_Data
    
    %% Geometry
    Shapefiles ==> Jl_Mask
    Raw_Data -.->|"Read Lat/Lon"| Jl_Mask
    Jl_Mask ==> Mask_Data

    %% Static Viz Flow
    Raw_Data --> Jl_Visu
    Mask_Data --> Jl_Visu
    
    %% Web App Flow
    Jl_Visu --> Jl_App

    %% DVC Sync (Personal API)
    Raw_Data o-.-o|"dvc push"| GDrive
    Mask_Data o-.-o|"dvc push"| GDrive
    Shapefiles o-.-o|"dvc push"| GDrive